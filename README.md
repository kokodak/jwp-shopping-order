# jwp-shopping-order

## 재화 정책 - 쿠폰

### 쿠폰 종류
- 쿠폰은 전체 상품에 적용되는 쿠폰과, 개별 상품에 적용되는 쿠폰 두 종류가 있다.
- 각각의 쿠폰은 퍼센트(%)로 할인하거나 고정된 가격을 할인한다.

정리하자면 4가지의 쿠폰 종류가 있다. (이하 종류)

1. 전체 상품에서 특정 퍼센트를 할인하는 쿠폰
2. 전체 상품에서 특정 금액을 할인하는 쿠폰
3. 개별 상품에서 특정 퍼센트를 할인하는 쿠폰
4. 개별 상품에서 특정 금액을 할인하는 쿠폰

### 쿠폰 사용방법
쿠폰은 다음과 같이 사용할 수 있다.

- 쿠폰은 전체 상품의 적용 가능한 쿠폰과 개별 금액을 적용할 수 있는 쿠폰 중 한가지 종류만 사용된다.
  - 따라서, 한 상품에 적용되는 쿠폰은 오로지 1가지다.
- 쿠폰은 구매하려고 체크박스로 선택된 아이템에만 적용이 된다.
  
몇 가지 예시

- 전체쿠폰(종류 1, 2) 사용시 상품에 개별쿠폰(종류3, 4)적용 불가능

![image](https://user-images.githubusercontent.com/56749516/243282981-a6a84a91-deae-40f5-8c6c-359ab93c273c.png)

- 상품 1, 상품 2에 각각 상품에 해당하는 개별 쿠폰(종류 3,4) 적용할지 선택 가능
  - 적용 시 전체쿠폰(종류1, 2) 적용 불가능

![image](https://user-images.githubusercontent.com/56749516/243283259-efae3b45-2d2d-438e-be01-abac64ed3211.png)

## 검증부 설계

### 실제 상품의 정보와 장바구니 상품의 정보가 달라진다면?

예상 시나리오

1. 사용자가 상품 A(3000원)를 상품 목록에서 본 뒤, 합리적인 가격이라 생각하여 장바구니에 담음.
2. 사용자가 장바구니 페이지 들어가서 상품 A(3000원)에 대한 정보를 다시 확인함.
3. 사용자가 '주문하기' 버튼을 누르기 전에, 상품 A 판매자가 상품 A의 가격을 100000원으로 변경함.
4. 사용자는 장바구니 페이지에서 나가지 않았고, 결과적으로 상품 A의 가격이 바뀌었다는 사실을 인지하지 못함.
5. 사용자는 그 상태로 '주문하기' 버튼을 눌러서 상품 A에 대한 주문을 진행했고, 결과적으로 3000원이 아닌 100000원이 결제됨.

### 해결책

- 서버 측에서 사용자가 장바구니에 담았을 시점의 상품 정보를 저장한다.
  - 사용자가 '주문하기' 버튼을 눌렀을 때, 최신 상품의 정보와 장바구니에 담았을 시점의 상품 정보를 비교하여 검증한다.
    - 실제 상품 정보와 장바구니 상품 정보가 같을 경우, 주문을 진행한다.
    - 실제 상품 정보와 장바구니 상품 정보가 다를 경우, 주문을 진행하지 않고 예외를 발생시켜 클라이언트에게 알린다.